#!/bin/bash

realpath() {
	python -c "import os,sys;print(os.path.realpath(sys.argv[1]))" "$1"
}

SCRIPT=`realpath $0`
BIN_PATH=`dirname $SCRIPT`
PEBBLE_PATH=`realpath $BIN_PATH/../`

export PEBBLE_TOOLCHAIN_PATH="$PEBBLE_PATH/arm-cs-tools/bin"
export PATH="$BIN_PATH:$PATH"
if [ ! -f "$PEBBLE_PATH/.venv/bin/activate" ]; then
	echo 'You must set up a venv before you can use the pebble tool.'
	echo "Try these commands from $PEBBLE_PATH:"
	echo
	echo 'python -m venv .venv'
	echo 'source .venv/bin/activate'
	echo 'pip install -r requirements.txt'
	echo 'deactivate'
	echo
	echo "If you still need help, contact devsupport@getpebble.com."
	exit 1
fi

export PHONESIM_PATH="$PEBBLE_PATH/.env/bin/pypkjs"

"$PEBBLE_PATH/.env/bin/python" "$PEBBLE_PATH/pebble.py" "$@"
